---
- name: Assign Permissions to AWX Teams for Ansible Utility Processes
  hosts: localhost
  gather_facts: no
  vars:
    awx_url: "https://192.168.4.100/api/v2"
    awx_token: 
    org_name: "Ansible Utility Processes"
    permissions:
      - execute
      - read
  tasks:
    - name: Get list of organizations
      uri:
        url: "{{ awx_url }}/organizations/"
        method: GET
        headers:
          Authorization: "Bearer {{ awx_token }}"
        return_content: yes
      register: organizations
      failed_when: organizations.status != 200
      # Ensure that the API call was successful

    - name: Debug: Check organizations response
      debug:
        var: organizations
      when: organizations is defined

    - name: Find the ID of the Ansible Utility Processes organization
      set_fact:
        utility_org_id: "{{ organizations.json.results | selectattr('name', 'equalto', org_name) | map(attribute='id') | first }}"
      when: organizations.json.results | length > 0

    - name: Debug: Check the organization ID
      debug:
        msg: "Utility Organization ID: {{ utility_org_id }}
